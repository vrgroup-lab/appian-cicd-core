name: Check org secrets
on:
  workflow_dispatch:

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Comprobar secretos APPIAN
        id: check
        shell: bash
        run: |
          set -euo pipefail

          missing=0

          check_secret() {
            local key_name="$1"
            local key_value="$2"
            if [ -z "$key_value" ]; then
              echo "::notice title=Secret missing::'$key_name' no está disponible en este repo (o es vacío/no visible)."
              echo "${key_name}=false" >> "$GITHUB_OUTPUT"
              missing=1
            else
              echo "::notice title=Secret present::'$key_name' está disponible."
              echo "${key_name}=true" >> "$GITHUB_OUTPUT"
            fi
          }

          # NOTA: No es posible indexar dinámicamente secrets.* en GitHub Actions.
          # Por eso se listan explícitamente los nombres a verificar.
          check_secret APPIAN_DEV_API_KEY  "${{ secrets.APPIAN_DEV_API_KEY }}"
          check_secret APPIAN_QA_API_KEY   "${{ secrets.APPIAN_QA_API_KEY }}"
          check_secret APPIAN_PROD_API_KEY "${{ secrets.APPIAN_PROD_API_KEY }}"
          check_secret APPIAN_DEMO_API_KEY "${{ secrets.APPIAN_DEMO_API_KEY }}"

          echo "any_missing=$([ "$missing" -eq 1 ] && echo true || echo false)" >> "$GITHUB_OUTPUT"

      - name: Resultado
        shell: bash
        run: |
          show() {
            local n="$1"; local v="$2"
            if [ "$v" = "true" ]; then
              echo "✅ '$n' presente"
            else
              echo "❌ '$n' ausente"
            fi
          }

          show APPIAN_DEV_API_KEY  "${{ steps.check.outputs.APPIAN_DEV_API_KEY }}"
          show APPIAN_QA_API_KEY   "${{ steps.check.outputs.APPIAN_QA_API_KEY }}"
          show APPIAN_PROD_API_KEY "${{ steps.check.outputs.APPIAN_PROD_API_KEY }}"
          show APPIAN_DEMO_API_KEY "${{ steps.check.outputs.APPIAN_DEMO_API_KEY }}"

          if [ "${{ steps.check.outputs.any_missing }}" = "true" ]; then
            echo "Uno o más secretos faltan."
            # Descomenta la siguiente línea si deseas que el workflow falle cuando falte alguno
            # exit 1
          fi
